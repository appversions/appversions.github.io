
<!DOCTYPE html>
<html>
<head>
    <!-- Plotly.js -->
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">

    <title>Version Control</title>

    <script src="plotly-latest.min.js"></script>
    <script type="text/javascript" src="./jquery.min.js"></script>
    <script type="text/javascript" src="./underscore.js"></script>
    <script type="text/javascript" src="./d3.v3.min.js"></script>
    <script type="text/javascript" src="./regression.min.js"></script>
    <script type="text/javascript" src="./simple-statistics.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        input[type=range][orient=vertical]
        {
            writing-mode: bt-lr; /* IE */
            -webkit-appearance: slider-vertical; /* WebKit */
            /*width: 8px;*/
            height: 100px;
            padding: 0 5px;
        }
        @font-face{
            font-family: Oswald;
            src: url("fonts/Oswald/Oswald-Regular.ttf");
        }
        @font-face{
            font-family: Oswald;
            src: url("fonts/Oswald/Oswald-Bold.ttf");
            font-weight: bold;
        }
        @font-face{
            font-family: Oswald;
            src: url("fonts/Oswald/Oswald-Light.ttf");
            font-weight: lighter;
        }
        @font-face{
            font-family: BebasNeue;
            src: url("fonts/BebasNeue/bebas_neue.otf");
        }
        font{
            cursor: default;
        }
        body{
            /*font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;*/
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            margin-top:0px;
            margin-left:0px;
            background:#f0f0f0;
            color:#323f4f;
            fill:#323f4f;
            cursor:default;
        }
        .title-div{
            width:740px; height:85px; left:25%; position:relative; text-align:center; border-bottom:none;
        }
        .title-text{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:55px;
            line-height:85px;
            font-weight:bold;
            text-transform:uppercase;
        }
        /*.subtitle-text{*/
        /*font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;*/
        /*font-size:45px;*/
        /*line-height:45px;*/
        /*font-weight:bold;*/
        /*!*text-transform:uppercase;*!*/
        /*}*/
        /*.appname-div{*/
        /*width:480px; height:30px;left: 20%; top:270px; position:absolute; text-align:left; border:none; background:transparent;*/
        /*}*/
        /*.appname-text {*/
        /*font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;*/
        /*font-size: 28px;*/
        /*line-height: 28px;*/
        /*font-weight: bold;*/
        /*}*/
        /*.suggestion-div{*/
        /*width:480px; height:30px;left: 15%; top:390px; position:absolute; text-align:left; border:none; background:transparent;*/
        /*}*/
        /*.suggestion-text {*/
        /*font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;*/
        /*font-size: 28px;*/
        /*line-height: 28px;*/
        /*font-weight: bold;*/
        /*}*/

        .scatterplot-apps-div{
            left:-20%;
            width: 550px;
            height: 400px;
        ;top:220px; position:absolute; text-align:left; border-bottom:none;
        }
        .userprefs-div{
            width:700px; height:30px;
            left:10%; top:370px; line-height:10px; position:absolute; text-align:left; background:transparent;
        }
        .userprefs-title{
            width:200px; height:30px; left:40%; top:30px; margin-left:-350px; line-height:28px; position:absolute; border:none; background:transparent;
        }
        .userprefs-title-text{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:28px;
            line-height:28px;
            font-weight:bold;
        }
        .userprefs-dropdown{
            width:300px; height:40px; left:-10%; top:180px; line-height:10px; position:absolute; text-align:left; border:solid 1px #aaaaaa; background:transparent;
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:16px;
            line-height:16px;
            font-weight:bold;
            color:#323f4f;
        }

        .userprefs-dropdown-cat{
            width:300px; height:40px; left:-10%; top:130px; line-height:10px; position:absolute; text-align:left; border:solid 1px #aaaaaa; background:transparent;
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:16px;
            line-height:16px;
            font-weight:bold;
            color:#323f4f;
        }
        .userprefs-piiprefs-title-div{
            width:700px; height:20px; left:10%; top:100px; line-height:18px; position:absolute; border:none; background:transparent;
        }
        .userprefs-piiprefs-title-text{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:18px;
            line-height:18px;

        }
        /*.suggest-div{*/
        /*width:700px; height:20px; left:15%; top:470px;  line-height:18px; position:absolute; border:none; background:transparent;*/
        /*}*/
        /*.suggest-text{*/
        /*font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;*/
        /*font-size:30px;*/
        /*line-height:18px;*/

        /*}*/
        .userprefs-piiprefs-div{
            width:700px; height:100px; left:15%; top:130px; line-height:10px; position:absolute; border:none; background:transparent;
        }
        .userprefs-piiprefs-table{
            font-size:15px;
            line-height:15px;
            border-collapse:collapse;
        }
        .userprefs-piiprefs-table-labels{
            font-size:12px;
            line-height:13px;
            border:none;
            text-transform:uppercase;
            text-align:center;
            width:400px;
            height:35px;
            font-weight:bold;
        }
        .userprefs-piiprefs-table-options{
            font-size:40px;
            line-height:25px;
            border:none;
            text-align:center;
            vertical-align: center;
            width:66px;
            height:35px;
        }
        .userprefs-piiprefs-options{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:18px;
            line-height:18px;
            border:solid 1px #aaaaaa;
            text-align:center;
            width:50px;
            height:30px;
            background:transparent;
            color:#323f4f;
        }
        /*#piiprefs-table{*/
        /*width:300px; height:40px; left:55%; top: 12%; line-height:10px;*/
        /*padding-top: 60px;*/
        /*border:none;*/
        /*display: table;*/
        /*margin-top: 100px;*/
        /*font-weight:bold;*/
        /*position:absolute;*/
        /*}*/
        /*#piiprefs-table-div*/
        /*{*/
        /*font-size:13px;*/
        /*text-transform:uppercase;*/
        /*text-align:center;*/
        /*border:none;*/
        /*font-weight:bold;*/
        /*}*/
        #circle {
            width: 10px;
            height: 10px;
            -webkit-border-radius: 25px;
            -moz-border-radius: 25px;
            border-radius: 25px;
        }
        #button{
            position: absolute;
            top: 730%;
            left: 30%;
        }
        .footer {
            bottom: -1000px;
            background-color: #efefef;
            text-align: center;
            font-weight: normal;
            position:absolute;
        }
        .legend-div {
            position : absolute;
            left:20%;
            top:300%;
            /*margin-bottom: -25em;*/
            /*padding-top: 280px;*/
            font-weight:bold;
        }
        .barplot-apps-div{
            width: 700px;
            height: 400px;
        ;top:300px; position:absolute; text-align:left; border-bottom:none;
        }
        .barplotpii-apps-div{
            width: 700px;
            height: 470px;
        ;top:300px; position:absolute; text-align:left; border-bottom:none;
        }
        .legend-div-table { list-style: none; right: 100px }
        .legend-div-table li { float: left; margin-right: 10px; }
        .legend-div-table span { border: 1px solid #ccc; float: left; width: 12px; height: 12px; margin: 5px; }
        /* your colors */
        .legend-div-table .red { background-color: #1f77b4 ; }
        .legend-div-table .black { background-color: #ff7f0e; }
        .legend-div-table .blue { background-color: #2ca02c ; }
        .legend-div-table .green { background-color: #d62728; }

        .legend-div-bar {
            position : absolute;
            left:20%;
            top:300%;
            /*margin-bottom: -25em;*/
            /*padding-top: 280px;*/
            font-weight:bold;
        }
        .legend-div-table-bar { list-style: none; right: 100px }
        .legend-div-table-bar li { float: left; margin-right: 10px; }
        .legend-div-table-bar span { border: 1px solid #ccc; float: left; width: 12px; height: 12px; margin: 5px; }
        /* your colors */
        .legend-div-table-bar .red { background-color: #1f77b4 ; }
        .legend-div-table-bar .black { background-color: #ff7f0e; }
        .legend-div-table-bar .blue { background-color: #0000ff ; }
        .legend-div-table-bar .green { background-color: #008000; }
        /*.nav-tabs{*/
        /*background-color:#161616;*/
        /*}*/
        .bigcircle-div{
            width:350px; height:350px; left:120%; top:200px; margin-left:-370px; position:absolute; text-align:left; border:none; background:transparent;
        }
        .bigcircle-summary-title-div{
            width:200px; height:80px; left:120%; top:335px; margin-left:-295px; position:absolute; text-align:center; border:none; background:transparent;
        }
        .bigcircle-summary-title-div-text{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:50px;
            line-height:80px;
            font-weight:bold;
            text-transform:uppercase;
        }
        .bigcircle-summary-subtitle-div{
            width:200px; height:24px; left:120%; top:430px; margin-left:-295px; position:absolute; text-align:center; border:none; background:transparent;
        }
        .bigcircle-summary-subtitle-div-text{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:24px;
            line-height:24px;
            font-weight:bold;
            text-transform:uppercase;
        }
        .bigcircle-summary-score-div{
            width:200px; height:24px; left:120%; top:300px; margin-left:-295px; position:absolute; text-align:center; border:none; background:transparent;
        }
        .bigcircle-summary-score-div-text{
            font-family: "Oswald", "Helvetica Newe", Helvetica, sans-serif;
            font-size:20px;
            line-height:20px;
            font-weight:bold;
            text-transform:uppercase;
        }

        .nav-pills > li {
            border: medium none;
            top:30px;
            left : 300px;
            font-size: 30px;
            background-color: #A9A9A9;
            color: #000;

        }
        .nav-pills > li > a:hover{
            background-color: #303136 !important;
            border: medium none;
            border-radius: 0;
            color:#fff;
        }
        .modalDialog {
            position: fixed;
            font-family: Arial, Helvetica, sans-serif;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0,0,0,0.8);
            z-index: 99999;
            opacity:0;
            -webkit-transition: opacity 400ms ease-in;
            -moz-transition: opacity 400ms ease-in;
            transition: opacity 400ms ease-in;
            pointer-events: none;
        }
        .modalDialog:target {
            opacity:1;
            pointer-events: auto;
        }
        .modalDialog > div {
            width: 600px;
            position: relative;
            margin: 10% auto;
            padding: 5px 20px 13px 20px;
            border-radius: 10px;
            background: #fff;
            background: -moz-linear-gradient(#fff, #999);
            background: -webkit-linear-gradient(#fff, #999);
            background: -o-linear-gradient(#fff, #999);
        }
        .close {
            background: #606061;
            color: #FFFFFF;
            line-height: 25px;
            position: absolute;
            right: -12px;
            text-align: center;
            top: -10px;
            width: 24px;
            text-decoration: none;
            font-weight: bold;
            -webkit-border-radius: 12px;
            -moz-border-radius: 12px;
            border-radius: 12px;
            -moz-box-shadow: 1px 1px 3px #000;
            -webkit-box-shadow: 1px 1px 3px #000;
            box-shadow: 1px 1px 3px #000;
        }
        .close:hover { background: #00d9ff; }

    </style>
</head>
<body>
<div id="openModal" class="modalDialog">
    <div>
        <a href="#close" title="Close" class="close">X</a>
        <h3>Welcome to App Versions</h3>
        <p>The one task we do almost weekly is to update apps in our phones. How does that affect our privacy? Is mobile privacy getting better or worse over time? </p>
          <p>
          This sites helps you answer these questions for 527 popular Android apps, covering 8,576 app releases over 8 years of app version history.</p>
          <p>
          For each app, we present a privacy risk score to measure the overall riskiness of a given version of such app. Use the interface on this site to select an app, and how much each type of personal information matters to you. As you change the importance of each information leak using the sliders, the page will update with new rankings.
          </p>

          <p> The second and the third tab illustrates personal information(including a tracking identifiers, your name, date of birth, credentials etc.), are sent to different parties via different channels(plain-text vs. secure) and how the behaviors change over time.
      <p> More details visit <a href="http://recon.meddle.mobi/appversions/details.html" target="_blank">here</a></div> </p>
    </div>
</div>

<div class="title-div">
    <font class="title-text">Should you Update your App?</font>
    <div style="bottom:30px">Back to <a href="http://recon.meddle.mobi">ReCon</a> | Learn more
    <a href="http://recon.meddle.mobi/appversions/details.html">details</a></div>
    <select id="userprefs-dropdown" class="userprefs-dropdown"></select>
    <select id="userprefs-dropdown-cat" class="userprefs-dropdown-cat"></select>


    <div class="tabs-div" id="tabs-div">
        <ul class="nav nav-pills" style="border-bottom:0px">
            <li class="dropdown active"><a href="#aaa" data-toggle="tab">Privacy Score</a></li>
            <li ><a href="#bbb" data-toggle="tab">Privacy Leaks</a></li>
            <li><a href="#ccc" data-toggle="tab">Sites Contacted</a></li>
        </ul>
        <div class="tab-content" id="tabs">
            <div class="tab-pane active" id="aaa"><div id="scatterplot-apps-div" class="scatterplot-apps-div"><!-- Plotly chart will be drawn inside this DIV --></div>
                <div id="hoverinfo" style="margin-left:80px;"></div>
                <div id="bigcircle-div" class="bigcircle-div"></div>
                <div id="bigcircle-summary-score-div" class="bigcircle-summary-score-div"></div>
                <div id="bigcircle-summary-title-div" class="bigcircle-summary-title-div"></div>
                <div id="bigcircle-summary-subtitle-div" class="bigcircle-summary-subtitle-div"></div>
                <button  id="button" type="button" class="btn btn-primary btn-lg active"><span class="glyphicon glyphicon-cog"></span> Settings</button>

                <div class="footer"><center style="height: 100px;
    width: 600px;
    padding-top: 115px;"><p>&copy; David Choffnes, Northeastern University, 2016. All rights reserved. To learn more, visit the <a href="http://recon.meddle.mobi">ReCon project page</a>.</p> This work is partially supported by a Data Transparency Lab grant.</center>
                </div>
            </div>
            <div class="tab-pane " id="bbb"><div id="barplotpii-apps-div" class="barplotpii-apps-div"><!-- Plotly chart will be drawn inside this DIV --></div>
                <div class="legend-div">
                    <ul class="legend-div-table">
                        <li><span class="red"></span> HTTPs 3rd</li>
                        <li><span class="black"></span> HTTP 1st</li>
                        <li><span class="blue"></span> HTTPs 1st</li>
                        <li><span class="green"></span> HTTP 3rd</li>
                    </ul>
                </div>
            </div>
            <div class="tab-pane" id="ccc"><div id="barplot-apps-div" class="barplot-apps-div"><!-- Plotly chart will be drawn inside this DIV --></div>
                <div class="legend-div-bar">
                    <ul class="legend-div-table-bar">
                        <li><span class="red"></span> HTTPs </li>
                        <li><span class="black"></span> HTTP </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


<!--<div id="suggest-div" class="suggest-div">-->
<!--<font class="suggest-text">Privacy - </font>-->
<!--</div>-->

<div id="barname-div" class="barname-div"></div>
<div id="userprefs-div" class="userprefs-div" style="width: 1000px;height: 1000px ;display: none;">
    <div id="userprefs-title" class="userprefs-title">
        <font class="userprefs-title-text">Preferences</font>(<a href="#openModal" id="open">More info</a>)
    </div>
    <div id="userprefs-piiprefs-title-div" class="userprefs-piiprefs-title-div">
        <font class="userprefs-piiprefs-title-text">Which PII do you care about the most?&nbsp;&nbsp;(Toggle slider higher for more importance)</font>
    </div>
    <div id="userprefs-piiprefs-div" class="userprefs-piiprefs-div">
    </div>
</div>
<!--<div id="piiprefs-table" class = "table-responsive">-->
<!--<table  border="1" cellspacing="0" cellpadding="4" id="piiprefs-table-div" class="table table-hover">-->

<!--</table>-->
<!--</div>-->




<script>

    $(document).ready(function() {
        var servicedata;

        function range(start, stop, step) {
            if (typeof stop == 'undefined') {
                // one param defined
                stop = start;
                start = 0;
            }

            if (typeof step == 'undefined') {
                step = 1;
            }

            if ((step > 0 && start >= stop) || (step < 0 && start <= stop)) {
                return [];
            }

            var result = [];
            for (var i = start; step > 0 ? i < stop : i > stop; i += step) {
                result.push(i);
            }

            return result;
        };


        $("button").click(function() {
            $("#userprefs-div").toggle('show');
        });

        function calculate(servicedata){
            var s_key_new = $("#userprefs-dropdown").val();
            var servicedata_keys_sorted = _.sortBy(_.keys(servicedata));
            for (i = 0; i < servicedata_keys_sorted.length; i++) {
                var s_key = servicedata_keys_sorted[i];
                var s_name = servicedata[s_key];
                var s_key_new_1 = Object.keys(s_name)[0];
                if (s_key_new_1 == s_key_new){
                    //console.log(s_key_new_1)
                    var s_name_new = Object.values(s_name)[0]['details']['title'];
                    var xdata = _.sortBy(_.keys(Object.values(s_name)[0]['versions']));
                    var xdata = xdata.sort(function(a, b){return a-b});
                    var pii_types = Object.values(s_name)[0]['details']['list_pii_types'];
                    var ydata = [];
                    var yregdata = [];
                    var date = [];
                    var domain = {};
                    var leak = {};
                    for (i = 0; i < xdata.length; i++) {



                        //console.log(Object.values(s_name)[0]['versions'][xdata[i]])
                        ydata.push(Math.round(Object.values(s_name)[0]['versions'][xdata[i]]["default_score"]*100)/100);
                        yregdata.push(Object.values(s_name)[0]['versions'][xdata[i]]["regress_score"]);
                        date.push(Object.values(s_name)[0]['versions'][xdata[i]]["release_date"]);
                        var domains = Object.values(s_name)[0]['versions'][xdata[i]]["raw_domains"];
                        var type_1 = {};
                        type_1['https'] = [];
                        type_1['http'] = [];
                        for (j=0;j<domains.length;j++){
                            var domain_ver = {};
                            domain_ver[domains[j][0]] = domains[j][2];
                            if (domains[j][1] === "https"){
                                type_1['https'].push(domain_ver);
                            }
                            else{
                                type_1['http'].push(domain_ver);
                            }
                        }
                        domain[xdata[i]] = type_1;
                        var leaks = (Object.values(s_name)[0]['versions'][xdata[i]]["raw_leaks"]);
                        var t2c = {'http_1':[],'http_3':[],'https_1':[],'https_3':[]};
                        for (j=0;j<leaks.length;j++) {
                            var leak_dict = {};
                            var id = leaks[j][0];
                            var protocol = leaks[j][1];
                            var party = leaks[j][2];
                            var val = leaks[j][3];
                            leak_dict[id] = val;
                            if (id != 'none') {
                                if (protocol === "http" && party === 1.0) {
                                    t2c['http_1'].push(leak_dict);
                                }
                                if (protocol === "http" && party === 3.0) {
                                    //console.log("g")
                                    t2c['http_3'].push(leak_dict);
                                }
                                if (protocol === "https" && party === 1.0) {
                                    //console.log("b")
                                    t2c['https_1'].push(leak_dict);
                                }
                                if (protocol === "https" && party === 3.0) {
                                    //console.log("l")
                                    t2c['https_3'].push(leak_dict);
                                }

                            }
                        }
                        leak[xdata[i]] = t2c;

                    }
                    break;
                }
            }
            return [s_name_new,xdata,yregdata,ydata,date,domain,pii_types,leak]
        }

        function updateDataAndD3(updatetype, servicedata,s_name_new,xdata,yregdata,ydata,date,domain,pii_types,leak) {

            if (updatetype=="minimal") {

                user_ratings['password'] = String($('#userprefs-piiprefs-table-options-password').find('#userprefs-piiprefs-options').val());
                user_ratings['location'] = String($('#userprefs-piiprefs-table-options-location').find('#userprefs-piiprefs-options').val());
                user_ratings['name'] = String($('#userprefs-piiprefs-table-options-name').find('#userprefs-piiprefs-options').val());
                user_ratings['id'] = String($('#userprefs-piiprefs-table-options-id').find('#userprefs-piiprefs-options').val());
                user_ratings['username'] = String($('#userprefs-piiprefs-table-options-username').find('#userprefs-piiprefs-options').val());
                user_ratings['email'] = String($('#userprefs-piiprefs-table-options-email').find('#userprefs-piiprefs-options').val());
                user_ratings['gender'] = String($('#userprefs-piiprefs-table-options-gender').find('#userprefs-piiprefs-options').val());
                user_ratings['firstname'] = String($('#userprefs-piiprefs-table-options-firstname').find('#userprefs-piiprefs-options').val());
                user_ratings['lastname'] = String($('#userprefs-piiprefs-table-options-lastname').find('#userprefs-piiprefs-options').val());
                user_ratings['android_id'] = String($('#userprefs-piiprefs-table-options-android_id').find('#userprefs-piiprefs-options').val());
                user_ratings['gsf_id'] = String($('#userprefs-piiprefs-table-options-gsf_id').find('#userprefs-piiprefs-options').val());
                user_ratings['hardware_serial'] = String($('#userprefs-piiprefs-table-options-hardware_serial').find('#userprefs-piiprefs-options').val());
                user_ratings['imei'] = String($('#userprefs-piiprefs-table-options-imei').find('#userprefs-piiprefs-options').val());
                user_ratings['mac_addr'] = String($('#userprefs-piiprefs-table-options-mac_addr').find('#userprefs-piiprefs-options').val());
                user_ratings['sim_id'] = String($('#userprefs-piiprefs-table-options-sim_id').find('#userprefs-piiprefs-options').val());
                user_ratings['serial_number'] = String($('#userprefs-piiprefs-table-options-serial_number').find('#userprefs-piiprefs-options').val());
                user_ratings['advertiser_id'] = String($('#userprefs-piiprefs-table-options-advertiser_id').find('#userprefs-piiprefs-options').val());


                user_ratings['none'] = 'none';
                //console.log(user_ratings)
                //console.log(user_ratings);
                compute_ydata(updatetype,servicedata)

            } else {
                //$(".title-div").append($(".appname-div"));
                //$(".appname-div").after($(".scatterplot-apps-div"));
                $(".scatterplot-apps-div").append($(".userprefs-div"));
                //$(".scatterplot-apps-div").append($(".suggest-div"));
                leakdata["servicename"] = s_name_new
                //appname_div.text(leakdata.servicename).style("opacity", 0);
                scatterplots(updatetype,xdata,yregdata,ydata,date);
                barplots(domain,date)
                generate_input(pii_types,servicedata)
                piibarplot(leak,date,pii_types)
                //appname_div.transition().duration(1500).delay(3).style("opacity", 1);
                table_div.style("opacity", 0);
                table_div.transition().duration(1500).delay(3).style("opacity", 1);
                graph_div.style("opacity", 0);
                graph_div.transition().duration(1500).delay(3).style("opacity", 1);
                bar_div.style("opacity", 0);
                bar_div.transition().duration(1500).delay(3).style("opacity", 1);
                barpii_div.style("opacity", 0);
                barpii_div.transition().duration(1500).delay(3).style("opacity", 1);

            }


        }

        function drop(){


            $('#userprefs-dropdown').empty();
            var servicedata_keys_sorted = _.sortBy(_.keys(servicedata));
            var options = "";
            var dropdown = {};
            for (i = 0; i < servicedata_keys_sorted.length; i++) {
                var s_key = servicedata_keys_sorted[i];
                var s_name = servicedata[s_key];
                var s_name_new = Object.values(s_name)[0]['details']['title']
                var s_key_new = Object.keys(s_name)[0];
                dropdown[s_name_new] = s_key_new;
            }

            var keys = Object.keys(dropdown);
            keys.sort();

            for (var j=0;j<keys.length;j++){
                var s_name_new = keys[j];
                var s_key_new = dropdown[keys[j]];
                if(s_name_new==s_key_default) {
                    $("#userprefs-dropdown").append('<option value="' + s_key_new + '" selected="selected">' + s_name_new + '</option>');
                } else {
                    $("#userprefs-dropdown").append('<option value="' + s_key_new + '">' + s_name_new + '</option>');
                }
            }
            $("#userprefs-dropdown").append(options);



            var data = calculate(servicedata);
            var s_name_new = data[0];
            var xdata = data[1]
            var yregdata = data[2]
            var ydata = data[3]
            var date = data[4]
            var domain = data[5]
            var pii_types = data[6]
            var leak = data[7]
            updateDataAndD3("full", servicedata,s_name_new,xdata,yregdata,ydata,date,domain,pii_types,leak)


            $('#userprefs-dropdown').change(function() {
                var data = calculate(servicedata);
                var s_name_new = data[0];
                var xdata = data[1];
                var yregdata = data[2];
                var ydata = data[3];
                var date = data[4];
                var domain = data[5]
                var pii_types = data[6]
                var leak = data[7]
                updateDataAndD3("full", servicedata,s_name_new,xdata,yregdata,ydata,date,domain,pii_types,leak)

            });

        }

        $.ajax({
            type: 'GET',
            url: 'summary.json',
            success: function (data){
                var options = "";
                var keys = _.sortBy(_.keys(data));
                for (var j=0;j<keys.length;j++) {
                    if (keys[j] == "Lifestyle") {
                        $("#userprefs-dropdown-cat").append('<option value="' + keys[j] + '" selected="selected">' + keys[j] + '</option>');
                    } else {
                        $("#userprefs-dropdown-cat").append('<option value="' + keys[j] + '">' + keys[j] + '</option>');
                    }
                }
                $("#userprefs-dropdown-cat").append(options);

                var cat_new = $("#userprefs-dropdown-cat").val();
                var key=cat_new.replace(/ & /g,"_");
                var final = "./categories/" + key + ".json";
                jaxcall(final)

                $('#userprefs-dropdown-cat').change(function () {
                    var cat_new = $("#userprefs-dropdown-cat").val();
                    var key = cat_new.replace(/ & /g, "_");
                    var final = "./categories/" + key + ".json";
                    $.ajax({
                        type: 'GET',
                        url: final,
                        success: function (data) {
                            servicedata = data
                            drop()
                        }
                    });
                });
            }

        });

        function jaxcall(final) {
            $.ajax({
                type: 'GET',
                url: final,
                success: function (data) {
                    servicedata = data
                    drop()


                }
            });

        }





        function scatterplots(updatetype,xdata,yregdata,ydata,date_new) {

            //console.log(ydata,yregdata)
            var varian = ss.variance(ydata)
            var myPlot = document.getElementById('scatterplot-apps-div'),
            hoverInfo = document.getElementById('hoverinfo')
            var new_x = range(1, xdata.length+1)
            var new_data = _.zip(new_x,ydata)
            var result = regression('linear', new_data);
            //var slope = result.equation[0]
            date_new.push("Unknown")
            new_array = _.unzip(result.points)
            yregdata = new_array[1]
            var slope = yregdata[yregdata.length - 1] - yregdata[0]
//            if (slope>-1.5 && slope<1.5){
//                if (yregdata[yregdata.length -1] - yregdata[0] >=1 ){
//
//                    if (ydata[ydata.length -1] - ydata[ydata.length -2] >1 ){
//                        updateD3_bigcircle(updatetype,"red","Worse")
//                    }
//                    else {
//                        updateD3_bigcircle(updatetype,"blue","Variable")
//                    }
//                }
//                else {
//                    if (ydata[ydata.length -1] - ydata[ydata.length -2] >1 ){
//                        updateD3_bigcircle(updatetype,"red","Worse")
//                    }
//                    else {
//                        updateD3_bigcircle(updatetype,"blue","Similar")
//                    }
//                }
//
//            }
            var newarray = ydata.slice(0, ydata.length -2)
            var mean_1 = ss.mean(newarray)
            var mean_2 = ss.mean([ydata[ydata.length -1],ydata[ydata.length -2]])
            if (slope>-1.5 && slope<1.5){
                if (varian>0.45){

                    if (ydata[ydata.length -1] - ydata[ydata.length -2] >1 ){
                        updateD3_bigcircle(updatetype,"red","Worse")
                    }
                    else {
                        updateD3_bigcircle(updatetype,"blue","Variable")
                    }
                }
                else {
                    if (ydata[ydata.length -1] - ydata[ydata.length -2] >1 ){
                        updateD3_bigcircle(updatetype,"red","Worse")
                    }
                    else {
                        updateD3_bigcircle(updatetype,"blue","Similar")
                    }
                }

            }
            else if (slope>=1.5)
            {
//                suggest_div.text('"Worse"').style("opacity", 0);
//                suggest_div.transition().style("color","red").duration(1500).delay(3).style("opacity", 1).style("font-weight","bold");
                if (ydata[ydata.length -1] - ydata[ydata.length -2] < -1 ){
                    updateD3_bigcircle(updatetype,"green","Better")
                }
                else {
                    updateD3_bigcircle(updatetype,"red","Worse")
                }

            }
            else if (slope<=-1.5)
            {
//                suggest_div.text('"Better"').style("opacity", 0);
//                suggest_div.transition().style("color","blue").duration(1500).delay(3).style("opacity", 1).style("font-weight","bold");
                if (ydata[ydata.length -1] - ydata[0]  > 1 ){
                    updateD3_bigcircle(updatetype,"red","Worse")
                }
                else {
                    updateD3_bigcircle(updatetype,"green","Better")
                }
            }
            var trace2 = {
                x: range(1, xdata.length+1),
                y: yregdata,
                hoverinfo : 'none',
                mode: 'lines',
                name: 'Privacy Risk Trend',
                type: 'scatter',
                textfont: {
                    family:  'Oswald, sans-serif'
                }
            };
            var array = [];

            for(var i=0;i<ydata.length;i++){
                array[i]="Privacy Risk Score : " + ydata[i] + "<br>" + "Application Version :" +" #" + xdata[i] ;
            }


            var tr = {
                y : ydata,
                x : range(1,xdata.length+1),
                text: array,
                hoverinfo : 'text',
                mode: 'markers',
                type: 'scatter',
                name: 'Privacy Risk Score <br>(Version Number)',
                textposition: 'bottom center',
                textfont: {
                    family:  'Oswald, sans-serif'
                },
                marker: { size: 8 }
            };

            var layout = {
                xaxis: {
                    tickmode : "array",
                    type : "linear",
                    autorange: true,
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    autotick: false,
                    tickvals: range(1,xdata.length+1),
                    ticktext : date_new,
                    title : "Date",
                    tickfont : {
                        size : "8"
                    }

                },
                hovermode:'closest',
                legend: {"orientation": "b",
                    x: 100,
                    y : 1},
                yaxis: {
                    autorange: true,
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    autotick: true,
                    title : "Risk Score",
                    showticklabels: true
                },
                textfont: {
                    family:  'Oswald, sans-serif'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                width: 650,
                height: 420,
                margin: {
                    l: 80,
                    r: 80,
                    b: 130,
                    t: 10,
                    pad: 0
                },
            };


            var config = {
                modeBarButtonsToRemove: ['toImage', 'sendDataToCloud', 'zoom2d', 'pan2d', 'select2d', 'lasso2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'resetScale2d', 'hoverClosestCartesian', 'hoverCompareCartesian'],
                displaylogo: false,
                showTips: false
            };
            var data = [tr, trace2];
//
            Plotly.newPlot('scatterplot-apps-div', data, layout, {displayModeBar: false});


//            myPlot.on('plotly_hover', function(data){
//                var infotext = data.points.map(function(d){
//                    return (d.data.name+': x= '+d.x+', y= '+d.y.toPrecision(3));
//                });
//
//                hoverInfo.innerHTML = infotext.join('<br/>');
//            })
//                .on('plotly_unhover', function(data){
//                    hoverInfo.innerHTML = '';
//                });

        }

        function barplots(domain,date) {
            $('#barplot-apps-div').empty();

            var keys_sorted = _.sortBy(_.keys(domain));
            var keys_sorted = keys_sorted.sort(function (a, b) {
                return a - b
            });
            var names = {};
            for (i = 0; i < keys_sorted.length; i++) {
                for (j = 0; j < domain[keys_sorted[i]]['http'].length; j++) {
                    if (names[domain[keys_sorted[i]]['http'][j]]) {
                        if (names[domain[keys_sorted[i]]['http'][j]] < Object.values(domain[keys_sorted[i]]['http'][j])[0]) {
                            names[Object.keys(domain[keys_sorted[i]]['http'][j])[0]] = Object.value(domain[keys_sorted[i]]['http'][j])[0];
                        }
                    }
                    else {
                        names[Object.keys(domain[keys_sorted[i]]['http'][j])[0]] = Object.values(domain[keys_sorted[i]]['http'][j])[0];
                    }
                }
                for (k = 0; k < domain[keys_sorted[i]]['https'].length; k++) {
                    if (names[domain[keys_sorted[i]]['https'][k]]) {
                        if (names[domain[keys_sorted[i]]['https'][k]] < Object.values(domain[keys_sorted[i]]['https'][k][0])) {
                            names[Object.keys(domain[keys_sorted[i]]['https'][k])[0]] = Object.values(domain[keys_sorted[i]]['https'][k])[0];
                        }
                    }
                    else {
                        names[Object.keys(domain[keys_sorted[i]]['https'][k])[0]] = Object.values(domain[keys_sorted[i]]['https'][k])[0];
                    }
                }
            }
            var props = Object.keys(names).map(function (key) {
                return {key: key, value: this[key]};
            }, names);
            props.sort(function (p1, p2) {
                return p2.value - p1.value;
            });
            var top = props.slice(0, 10);
            var flag = 0;
            for (var key=0;key<top.length; key++ )
            {
                var web = top[key].key
                var http = [];
                var https = [];
                for (i = 0; i < keys_sorted.length; i++) {
                    for (j = 0; j < domain[keys_sorted[i]]['http'].length; j++) {
                        if (Object.keys(domain[keys_sorted[i]]['http'][j])[0] == web) {
                            var val = (Object.values(domain[keys_sorted[i]]['http'][j])[0]);
                            break;
                        }
                        else {
                            var val = 0;
                        }
                    }
                    http.push(val);
                    for (k = 0; k < domain[keys_sorted[i]]['https'].length; k++) {
                        if (Object.keys(domain[keys_sorted[i]]['https'][k])[0] == web) {
                            var val = (Object.values(domain[keys_sorted[i]]['https'][k])[0]);
                            break;
                        }
                        else {
                            var val = 0;
                        }
                    }
                    https.push(val);
                    if (key==(top.length -1) )
                    {
                        flag = 1;
                    }
                }
                var new_id = "barplot-div-new" + key
                var new_app = "barname-div" + key
                var div = $("<div id=" + new_id + " class='barplot-div-new' ></div>");
                //$(".scatterplot-apps-div").after($(".barplot-apps-div"))
                $(".barplot-apps-div").append(div);
                barplot_actual(keys_sorted, http, https, new_id,flag,web,date)

            }
        }


        function piibarplot(leak,date,pii_types) {
            $('#barplotpii-apps-div').empty();

            var keys_sorted = _.sortBy(_.keys(leak));
            var flag = 0;
            var keys_sorted = keys_sorted.sort(function (a, b) {
                return a - b
            });
            for (k =0; k< pii_types.length;k++) {
                var http_3 = [];
                var http_1 = [];
                var https_1 = [];
                var https_3 = [];

                for (i = 0; i < keys_sorted.length; i++) {
                    if (leak[keys_sorted[i]]['https_3'].length != 0) {
                        for (j = 0; j < leak[keys_sorted[i]]['https_3'].length; j++) {
                            if (Object.keys(leak[keys_sorted[i]]['https_3'][j])[0] == pii_types[k]) {
                                var val = (Object.values(leak[keys_sorted[i]]['https_3'][j])[0]);
                                break;
                            }
                            else {
                                var val = 0;
                            }
                        }
                    }
                    else {
                        var val = 0;
                    }
                    https_3.push(val);
                    if (leak[keys_sorted[i]]['http_1'].length != 0) {
                        for (j = 0; j < leak[keys_sorted[i]]['http_1'].length; j++) {
                            if (Object.keys(leak[keys_sorted[i]]['http_1'][j])[0] == pii_types[k]) {
                                var val = (Object.values(leak[keys_sorted[i]]['http_1'][j])[0]);
                                break;
                            }
                            else {
                                var val = 0;
                            }
                        }
                    }
                    else {
                        var val = 0;
                    }
                    http_1.push(val);

                    if (leak[keys_sorted[i]]['http_3'].length != 0) {
                        for (j = 0; j < leak[keys_sorted[i]]['http_3'].length; j++) {
                            if (Object.keys(leak[keys_sorted[i]]['http_3'][j])[0] == pii_types[k]) {
                                var val = (Object.values(leak[keys_sorted[i]]['http_3'][j])[0]);
                                break;
                            }
                            else {
                                var val = 0;
                            }
                        }
                    }
                    else {
                        var val = 0;
                    }
                    http_3.push(val);
                    if (leak[keys_sorted[i]]['https_1'].length != 0) {
                        for (j = 0; j < leak[keys_sorted[i]]['https_1'].length; j++) {
                            if (Object.keys(leak[keys_sorted[i]]['https_1'][j])[0] == pii_types[k]) {
                                var val = (Object.values(leak[keys_sorted[i]]['https_1'][j])[0]);
                                break;
                            }
                            else {
                                var val = 0;
                            }
                        }
                    }
                    else {
                        var val = 0;
                    }
                    https_1.push(val);
                    if (k==(pii_types.length -1) )
                    {
                        flag = 1;
                    }
                }
                var new_id = "barplotpii-div-new" + k;
                var new_app = "barnamepii-div" + k;
                var div = $("<div id=" + new_id + " class='barplotpii-div-new' ></div>");
                // $(".barplot-apps-div").after($(".barplotpii-apps-div"))
                $(".barplotpii-apps-div").append(div);
                barpiiplot(keys_sorted,http_1,http_3,https_1,https_3,new_id,flag,pii_types[k],date)
            }
        }


        function barpiiplot(keys_sorted,http_1,http_3,https_1,https_3,div,flag,pii,date){
            var t2c = {'password': 'Password',
                'email': 'Email',
                'gender' : 'Gender',
                'phone_number': 'Phone Number',
                'firstName': 'First Name',
                'lastName': 'Last Name',
                'location' :'Location',
                'android_id':'Android ID',
                'gsf_id':'GSF ID',
                'hardware_serial':'Hardware Serial',
                'imei':'IMEI',
                'mac_addr':'MAC Address',
                'sim_id':'SIM ID',
                'serial_number':'Serial Number',
                'advertiser_id':'Advertiser ID',
                'none': 'none',
                'id' : 'ID',
                'username': 'Username',
                'name' : 'Name'
            };
            var title = '';
            var b = 1;
            var l = 1;
            var h = 100;
            if (flag == 1 )
            {
                title = 'Date';
                l = 100;
                b = 100;
                h = 220;
            }
            var trace3 = {
                x: range(1, keys_sorted.length+1),
                y: https_1,
                name: 'HTTPs 1st Party',
                type: 'bar'
            };

            var trace2 = {
                x: range(1, keys_sorted.length+1),
                y: http_1,
                name: 'HTTP 1st Party',
                type: 'bar'
            };
            var trace1 = {
                x: range(1, keys_sorted.length+1),
                y: https_3,
                name: 'HTTPs 3rd Party',
                type: 'bar'
            };
            var trace4 = {
                x: range(1, keys_sorted.length+1),
                y: http_3,
                name: 'HTTP 3rd Party',
                type: 'bar'
            };

            var data = [trace1, trace2,trace3,trace4];

            var layout = {
                annotations: [ {
                    xref: 'paper',
                    yref: 'paper',
                    x: 0,
                    xanchor: 'right',
                    y: 0,
                    yanchor: 'bottom',
                    text: t2c[pii],
                    showarrow: false
                }] ,
                showlegend: false,
                autosize:'false',
                width: 650,
                height: h,
                margin: {
                    l: 150,
                    r: 100,
                    b: b,
                    t: 1,
                    pad: 0
                },
                barmode : 'stack',
                xaxis: {
                    tickmode : "array",
                    type : "linear",
                    tickvals: range(1,keys_sorted.length+1),
                    ticktext : date,
                    autorange: true,
                    title: title,
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    autotick: false,
                    tickfont : {
                        size : "8"
                    }
                },
                yaxis: {
                    autorange: true,
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    autotick: true,
                    showticklabels: false
                },
                textfont: {
                    family:  'Oswald, sans-serif'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'

            };


            Plotly.newPlot( div, data, layout, {displayModeBar: false});
        }

        function barplot_actual(keys_sorted,http,https,div,flag,web,date){
            var title = '';
            var b = 1;
            var l = 1;
            var h = 60;
            if (flag == 1 )
            {
                title = 'Date';
                l = 100;
                b = 100;
                h = 160;
            }
            var trace2 = {
                x: range(1, keys_sorted.length+1),
                y: http,
                name: 'HTTP',
                type: 'bar'
            };

            var trace1 = {
                x: range(1, keys_sorted.length+1),
                y: https,
                name: 'HTTPs',
                type: 'bar'
            };

            var data = [trace1, trace2];

            var layout = {
                annotations: [ {
                    xref: 'paper',
                    yref: 'paper',
                    x: 0,
                    xanchor: 'right',
                    y: 0,
                    yanchor: 'bottom',
                    text: web,
                    showarrow: false
                }] ,
                showlegend: false,
                autosize:'false',
                width: 650,
                height: h,
                margin: {
                    l: 150,
                    r: 100,
                    b: b,
                    t: 1,
                    pad: 0
                },
                barmode : 'stack',
                xaxis: {
                    tickmode : "array",
                    type : "linear",
                    tickvals: range(1,keys_sorted.length+1),
                    ticktext : date,
                    autorange: true,
                    title: title,
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    autotick: false,
                    tickfont : {
                        size : "8"
                    }
                },
                yaxis: {
                    autorange: true,
                    showgrid: true,
                    zeroline: false,
                    showline: true,
                    autotick: true,
                    showticklabels: false
                },
                textfont: {
                    family:  'Oswald, sans-serif'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',

            };


            var config = {
                modeBarButtonsToRemove: ['toImage', 'sendDataToCloud', 'zoom2d', 'pan2d', 'select2d', 'lasso2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'resetScale2d', 'hoverClosestCartesian', 'hoverCompareCartesian'],
                displaylogo: false,
                showTips: false
            };

            Plotly.newPlot( div, data, layout, {displayModeBar: false});
        }

        var s_key_default = "Pinterest"
        var leakdata = {"servicename":"Pinterest"}
        var piisleaked_labels = [
            {"key":"password", "name":"Password", "abbreviation":"pw", "value": "'5'" },
            {"key":"username", "name":"Username", "abbreviation":"u", "value":"'4'" },
            {"key":"name", "name":"Name", "abbreviation":"n", "value":"'3'" },
            {"key":"location", "name":"Location", "abbreviation":"l", "value":"'2'" },
            {"key":"id", "name":"Unique Identifiers", "abbreviation":"id", "value":"'1'" },
            {"key":"firstname", "name":"FirstName", "abbreviation":"fn", "value":"'3'" },
            {"key":"lastname", "name":"LastName", "abbreviation":"ln", "value":"'3'" },
            {"key":"gender", "name":"Gender", "abbreviation":"g", "value":"'3'" },
            {"key":"email", "name":"email", "abbreviation":"em", "value":"'3'" },
            {"key":"android_id", "name":"Android ID", "abbreviation":"aid", "value":"'1'" },
            {"key":"gsf_id", "name":"GSF ID", "abbreviation":"gid", "value":"'1'" },
            {"key":"hardware_serial", "name":"Hardware Serial", "abbreviation":"h_s", "value":"'1'" },
            {"key":"imei", "name":"IMEI", "abbreviation":"imei", "value":"'1'" },
            {"key":"mac_addr", "name":"MAC Address", "abbreviation":"mac", "value":"'1'" },
            {"key":"sim_id", "name":"SIM ID", "abbreviation":"s_id", "value":"'1'" },
            {"key":"serial_number", "name":"Serial Number", "abbreviation":"s_num", "value":"'1'" },
            {"key":"advertiser_id", "name":"Advertiser ID", "abbreviation":"a_id", "value":"'1'" }
        ];


        var userprefs_piiprefs_table = d3.select("#userprefs-piiprefs-div").append("table").attr("class", "userprefs-piiprefs-table").attr("id", "userprefs-piiprefs-table");
        //var appname_div = d3.select("#appname-div").append("text").text(leakdata.servicename).attr("class", "appname-text").style("opacity", 1);
        var user_ratings = {"password":5, "username": 4, "name":3, "location":2, "id":1 ,  "none": "none","firstname":3,"lastname":3,"gender":3,"android_id":1,"gsf_id":1,"hardware_serial":1,"imei":1,"mac_addr":1,"sim_id":1,"serial_number":1,"advertiser_id":1};;
        var lable_div = d3.select("#legend").append("text").text("Legend").attr("class", "appname-text").style("opacity", 1);
        var table_div = d3.select("#userprefs-piiprefs-div").attr("class", "userprefs-piiprefs-div").style("opacity", 1);
        var graph_div = d3.select("#scatterplot-apps-div").attr("class", "scatterplot-apps-div").style("opacity", 1);
        var bar_div = d3.select("#barplot-apps-div").attr("class", "barplot-apps-div").style("opacity", 1);
        var barpii_div = d3.select("#barplotpii-apps-div").attr("class", "barplotpii-apps-div").style("opacity", 1);
//        var suggest_div = d3.select("#suggest-div").append("text").attr("class", "suggest-text").style("opacity", 1);
//        var suggest_new_div = d3.select("#suggest-div").append("text").attr("class", "suggest-text").style("opacity", 1);
//        suggest_new_div.text(" Over Time");
        var bigcircle_summary_a_div = d3.select("#bigcircle-summary-title-div").append("text").attr("class", "bigcircle-summary-title-div-text").style("opacity", 1);
        var bigcircle_summary_b_div = d3.select("#bigcircle-summary-subtitle-div").append("text").text("Over Time").attr("class", "bigcircle-summary-subtitle-div-text").style("opacity", 1);
        var bigcircle_summary_c_div = d3.select("#bigcircle-summary-score-div").append("text").text("Privacy").attr("class", "bigcircle-summary-score-div-text").style("opacity", 1);

        var recommend_circleRadius = 175;
        var recommend_circleAngle = 2 * Math.PI;
        var recommend_svgArc = d3.svg.arc().innerRadius(recommend_circleRadius - 20).outerRadius(recommend_circleRadius).startAngle(0);
        var recommend_container = d3.select("#bigcircle-div").append("svg").attr("width", 350).attr("height", 350).append("g").attr("transform", "translate(175, 175)");
        var recommend_circleDraw = recommend_container.append("path")
            .datum({endAngle: 0})
            .attr("fill", "red")
            .attr("fill-opacity", 0)
            .attr("d", recommend_svgArc);

        function updateD3_bigcircle(updatetype, leakColor, type_name) {
            var opacity_start = 1;
            var bigcircle_start = 2 * Math.PI;

            if (updatetype == "full"){
                var opacity_start = 0;
                var bigcircle_start = 0;
            }
            bigcircle_summary_a_div.text(type_name).style("opacity", 0);
            bigcircle_summary_a_div.transition().style("color",leakColor).duration(1500).delay(3).style("opacity", 1).style("font-weight","bold");            recommend_circleDraw.datum({endAngle: bigcircle_start}).attr("fill", leakColor).attr("fill-opacity", opacity_start).attr("d", recommend_svgArc);
            recommend_circleDraw.transition().duration(1500).delay(0).attr("fill-opacity", 1).call(arcTween, recommend_circleAngle, recommend_svgArc);
        };

        function arcTween(transition, newAngle, theArc) {
            transition.attrTween("d", function(d) {
                var interpolate = d3.interpolate(d.endAngle, newAngle);
                return function(t) {
                    d.endAngle = interpolate(t);
                    return theArc(d);
                };
            });
        }

        function generate_input(new_date,servicedata){
            var t2c = {'password': 'password',
                'email': 'email',
                'gender' : 'gender',
                'phone_number': 'phone_number',
                'firstName': 'firstName',
                'lastName': 'lastName',
                'location' :'location',
                'android_id':'id',
                'gsf_id':'id',
                'hardware_serial':'id',
                'imei':'id',
                'mac_addr':'id',
                'sim_id':'id',
                'serial_number':'id',
                'advertiser_id':'id',
                'none': 'none',
                'id' : 'id',
                'username': 'username',
                'name' : 'name'
            };
            var date = []
            for (var x in new_date){
                date.push(t2c[new_date[x]])
            }

            $('#userprefs-piiprefs-table').empty();
            var piisleaked_labels_new = [
                {"key":"password", "name":"Password", "abbreviation":"pw", "value": "'5'" },
                {"key":"username", "name":"Username", "abbreviation":"u", "value":"'4'" },
                {"key":"name", "name":"Name", "abbreviation":"n", "value":"'3'" },
                {"key":"firstname", "name":"FirstName", "abbreviation":"fn", "value":"'3'" },
                {"key":"lastname", "name":"LastName", "abbreviation":"ln", "value":"'3'" },
                {"key":"gender", "name":"Gender", "abbreviation":"g", "value":"'3'" },
                {"key":"email", "name":"email", "abbreviation":"em", "value":"'3'" },
                {"key":"location", "name":"Location", "abbreviation":"l", "value":"'2'" },
                {"key":"id", "name":"Tracking ID", "abbreviation":"id", "value":"'1'" },
//                {"key":"android_id", "name":"Tracking ID", "abbreviation":"aid", "value":"'1'" },
//                {"key":"gsf_id", "name":"GSF ID", "abbreviation":"Tracking ID", "value":"'1'" },
//                {"key":"hardware_serial", "name":"Tracking ID", "abbreviation":"h_s", "value":"'1'" },
//                {"key":"imei", "name":"IMEI", "abbreviation":"imei", "value":"'1'" },
//                {"key":"mac_addr", "name":"MAC Address", "abbreviation":"mac", "value":"'1'" },
//                {"key":"sim_id", "name":"SIM ID", "abbreviation":"s_id", "value":"'1'" },
//                {"key":"serial_number", "name":"Serial Number", "abbreviation":"TRACKING ID", "value":"'1'" },
//                {"key":"advertiser_id", "name":"Advertiser ID", "abbreviation":"TRACKING ID", "value":"'1'" }
            ];
            var piisleaked_labels = [];

            for (i in piisleaked_labels_new){
                if (date.indexOf(piisleaked_labels_new[i].key) != -1) {
                    piisleaked_labels.push(piisleaked_labels_new[i])
                }
            }

            var userprefs_piiprefs_tr0 = userprefs_piiprefs_table.append("tr");
            var userprefs_piiprefs_tr1 = userprefs_piiprefs_table.append("tr");
            var userprefs_tr0_td1_labels = userprefs_piiprefs_tr0.selectAll("td").data(piisleaked_labels).enter().append("td")
                .html(function(d) {  if (date.indexOf(d.key) != -1){
                    return d.name; }})
                .attr("class", "userprefs-piiprefs-table-labels");
            var userprefs_tr1_td1_options = userprefs_piiprefs_tr1.selectAll("td")
                .data(piisleaked_labels).enter().append("td")
                .html(function(d) {
                        if (date.indexOf(d.key) != -1){
                            return "<input type='range' orient='vertical' max='5' min='1' step='1' id='userprefs-piiprefs-options'" + ' value=' + d.value + "/>" ;
                        }
                    }
                )
                .attr("class", "userprefs-piiprefs-table-options")
                .attr("id", function(d) { if (date.indexOf(d.key) != -1){
                    return "userprefs-piiprefs-table-options-" + d.key; }
                });




            $('#userprefs-piiprefs-table-options-password').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);
            });

            $('#userprefs-piiprefs-table-options-location').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });

            $('#userprefs-piiprefs-table-options-name').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });

            $('#userprefs-piiprefs-table-options-id').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });

            $('#userprefs-piiprefs-table-options-username').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-lastname').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-firstname').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-email').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-gsf_id').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-serial_number').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-imei').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-android_id').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-hardware_serial').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-mac_addr').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-advertiser_id').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-gender').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });
            $('#userprefs-piiprefs-table-options-sim_id').find('#userprefs-piiprefs-options').change(function() {
                updateDataAndD3("minimal",servicedata);

            });


        }







        function getBaseLog(x, y) {
            return Math.log(x) / Math.log(y);
        }

        function compute_ydata(updatetype,servicedata) {
            var s_key_new = $("#userprefs-dropdown").val();
            //console.log(s_key_new)
            var t2c = {'password': 'password',
                'email': 'email',
                'gender' : 'gender',
                'phone_number': 'phone_number',
                'firstName': 'firstName',
                'lastName': 'lastName',
                'location' :'location',
                'android_id':'id',
                'gsf_id':'id',
                'hardware_serial':'id',
                'imei':'id',
                'mac_addr':'id',
                'sim_id':'id',
                'serial_number':'id',
                'advertiser_id':'id',
                'none': 'none',
                'id' : 'id',
                'username': 'username',
                'name' : 'name'
            }


            var opt_http_1st = {"5" : [11000000000.0,99999999999999999999], "4" : [110000000.0 ,9999999999999999], "3" : [1100000.0,999999999999], "2" : [11000.0,99999999], "1" : [110.0,9999], "none" : [1.1,99] }
            var opt_https_1st = {"5" : [10000000000,99999999999999999999], "4" : [100000000,9999999999999999] , "3" : [1000000.0,999999999999] ,"2" : [10000.0,99999999], "1" : [100.0 ,9999], "none" : [1.0,99]}
            var opt_http_3rd = {"5" : [11010000000.0,99999999999999999999], "4" : [110100000.0 , 9999999999999999], "3" : [1101000.0,999999999999], "2" : [11010.0,99999999], "1" : [110.1,9999], "none":[1.101,99] }
            var opt_https_3rd = {"5" : [10010000000.0,99999999999999999999], "4" : [100100000.0 ,9999999999999999], "3" : [1001000.0,999999999999], "2" : [10010.0,99999999], "1" : [100.1,9999] , "none" : [1.001,99] }

            var servicedata_keys_sorted = _.sortBy(_.keys(servicedata));

            for (i = 0; i < servicedata_keys_sorted.length; i++) {
                var s_key = servicedata_keys_sorted[i];
                var s_name = servicedata[s_key];
                var s_key_new_1 = Object.keys(s_name)[0];
                if (s_key_new_1 == s_key_new) {
                    var s_name_new = Object.values(s_name)[0]['details']['title'];
                    var xdata = _.sortBy(_.keys(Object.values(s_name)[0]['versions']))
                    var xdata = xdata.sort(function (a, b) {
                        return a - b
                    });
                    var ydata = [];
                    var yregdata = [];
                    var date = [];
                    for (i = 0; i < xdata.length; i++) {
                        var score = 0;
                        date.push(Object.values(s_name)[0]['versions'][xdata[i]]["release_date"])
                        var leaks = (Object.values(s_name)[0]['versions'][xdata[i]]["raw_leaks"])
                        for (j = 0; j < leaks.length; j++) {
                            //console.log(leaks[j])
                            if (leaks[j][1] == "http" && leaks[j][2] == 3.0) {
                                //console.log(opt_http_3rd[user_ratings[leaks[j][0]]][0])

                                score = score + Math.min(leaks[j][3] * opt_http_3rd[user_ratings[t2c[leaks[j][0]]]][0],
                                        leaks[j][3] * opt_http_3rd[user_ratings[t2c[leaks[j][0]]]][1])
                                //console.log(score)
                            }
                            if (leaks[j][1] == "http" && leaks[j][2] == 1.0) {
                                //console.log(opt_http_1st[user_ratings[leaks[j][0]]][0])
                                score = score + Math.min(leaks[j][3] * opt_http_1st[user_ratings[t2c[leaks[j][0]]]][0], leaks[j][3] * opt_http_1st[user_ratings[t2c[leaks[j][0]]]][1])
                                //console.log(score)
                            }
                            if (leaks[j][1] == "https" && leaks[j][2] == 3.0) {
                                //console.log(opt_https_3rd[user_ratings[leaks[j][0]]], leaks[j][0])
                                console.log(leaks[j][0])
                                score = score + Math.min(leaks[j][3] * opt_https_3rd[user_ratings[t2c[leaks[j][0]]]][0], leaks[j][3] * opt_https_3rd[user_ratings[t2c[leaks[j][0]]]][1])
                                //console.log(score)
                            }
                            if (leaks[j][1] == "https" && leaks[j][2] == 1.0) {
                                //console.log(opt_https_1st[user_ratings[leaks[j][0]]][0])
                                score = score + Math.min(leaks[j][3] * opt_https_1st[user_ratings[t2c[leaks[j][0]]]][0], leaks[j][3] * opt_https_1st[user_ratings[t2c[leaks[j][0]]]][1])
                                //console.log(score)
                            }
                        }


                        var logscore = getBaseLog(score, 100)
                        // console.log(xdata[i]+":"+score+" "+ logscore)
                        ydata.push(Math.round(logscore*100)/100)
                    }
                    break;
                }


            }
            //console.log(ydata,xdata)
            scatterplots(updatetype,xdata,yregdata,ydata,date);
        }
    });




    function compute_table(servicedata) {
        var s_key_new = $("#userprefs-dropdown").val();
        //console.log(s_key_new)

        var servicedata_keys_sorted = _.sortBy(_.keys(servicedata));

        var dictdata = {};
        for (i = 0; i < servicedata_keys_sorted.length; i++) {
            var s_key = servicedata_keys_sorted[i];
            var s_name = servicedata[s_key];
            var s_key_new_1 = Object.keys(s_name)[0]
            if (s_key_new_1 == s_key_new) {
                var s_name_new = Object.values(s_name)[0]['details']['title'];
                var xdata = _.sortBy(_.keys(Object.values(s_name)[0]['versions']))
                var xdata = xdata.sort(function (a, b) {
                    return a - b
                });
                //console.log(xdata)
                var pii_types = Object.values(s_name)[0]['details']['list_pii_types'];
                var ydata = [];
                var score = 0;
                for (i = 0; i < xdata.length; i++) {
                    var score = 0;
                    //console.log(Object.values(s_name)[0])
                    var leaks = (Object.values(s_name)[0]['versions'][xdata[i]]["raw_leaks"])

                    dictdata[xdata[i]] = leaks;
                }
                return [dictdata, pii_types]
            }

        }
    }





    // =======================================================================
    // GOOGLE ANALYTICS REFERENCE
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-87712657-1', 'auto');
    ga('send', 'pageview');
    // =======================================================================

</script>

</body>

</html>
